!function(){var e;function c(e,t){for(var r=-1,n=t.length>>>0;++r<n;)if(e===t[r])return!0;return!1}(e=function(t){var e,r,n,i,u,s,l,a,o=this;for(l in null==t&&(t={}),this.opt=t,this.root=e="string"==typeof t.root?ld$.find(document,t.root,0):t.root,this.evtHandler={},this.fields={},this.status=n={all:1},this.el=i={},null!=t.submit&&(i.submit="string"==typeof t.submit?ld$.find(this.root,t.submit,0):t.submit),i.submit||(u=ld$.find(e,"[type=submit]",0))&&(i.submit=u),["debounce","verify","names","getFields","afterCheck"].map(function(e){if(t[e])return o[e]=t[e]}),s=function(e){return o.check({n:e&&e.target?e.target.getAttribute("name"):void 0,e:e})},this.fields=r=this.getFields(e),this.values(t.values||{}),r)a=r[l],(Array.isArray(a)?a:[a]).map(c),n[l]=1;return this.checkDebounced=debounce(330,function(e,r,n,t,i){var u,s=this.names(n),l=n.all;return delete n.all,this.afterCheck(n,r),u=s.map(function(e){return null!=n[e]&&0===n[e]}).filter(function(e){return!e}).length,null==n.all&&(n.all=u?1:0),s.map(function(t){return(Array.isArray(r[t])?r[t]:[r[t]]).map(function(e){e=e.classList;return e.toggle("is-invalid",2===n[t]),e.toggle("is-valid",n[t]<1),e})}),l!==n.all&&this.fire("readystatechange",0===n.all),(l=this.el.submit)&&l.classList.toggle("disabled",0!==n.all),t()}),t.init&&t.init.apply(this),this.opt.initCheck&&this.checkAll(),this;function c(e){return e.addEventListener("input",s)}}).prototype=function(e,t){var r,n={}.hasOwnProperty;for(r in t)n.call(t,r)&&(e[r]=t[r]);return e}(Object.create(Object.prototype),{on:function(e,t){var r;return((r=this.evtHandler)[e]||(r[e]=[])).push(t)},fire:function(e){for(var t,r,n,i,u=[],s=[],l=1,a=arguments.length;l<a;++l)s.push(arguments[l]);for(t=s,l=0,n=(r=this.evtHandler[e]||[]).length;l<n;++l)i=r[l],u.push(i.apply(this,t));return u},field:function(e){return this.fields[e]},reset:function(){var e=[this.status,this.fields],r=e[0],n=e[1];return r.all=1,this.names(r).map(function(e){var t=n[e];return Array.isArray(t)?t.map(function(e){return e.checked=it.defaultChecked,e.classList.remove("is-invalid","is-valid")}):(t.value="",t.classList.remove("is-invalid","is-valid")),r[e]=1}),this.check()},ready:function(){return 0===this.status.all},verify:function(e,t,r){return t?0:2},names:function(){var e,t=[];for(e in this.fields)t.push(e);return t},debounce:function(){return!0},afterCheck:function(){},values:function(e){var r,t,n,i,u,s=[],l=this;if(null!=e){for(r in t=e||{})n=t[r],(i=this.fields[r])&&(i=Array.isArray(i)?i:[i],s.push(i.map(a)));return s}for(r in u={},t=this.fields)n=t[r],(Array.isArray(n)?n:[n]).map(o);return u;function a(e){var t=e.getAttribute("type");if("file"!==t)return"radio"===t?e.checked=e.value===n:"checkbox"===t?e.checked=c(e.value,n||[]):l.fields[r].value=n}function o(e){var t=e.getAttribute("type");return"checkbox"!==t?"radio"!==t?u[r]="checkbox"===e.getAttribute("type")?e.checked:e.value:e.checked?u[r]=e.value:void 0:e.checked?(u[r]||(u[r]=[])).push(e.value):void 0}},getfd:function(){var t,e,r,n,i,u,s=new FormData;for(t in e=this.fields)if((r=e[t]).files&&r.files.length)for(n=0,i=r.files.length;n<i;++n)u=n,s.append(t+"[]",r.files[u]);else Array.isArray(r)?r.map(l):s.append(t,r.value);return s;function l(e){if(e.checked)return s.append(t+"[]",e.value)}},getFields:function(e){var r=this,n={};return ld$.find(this.root,"[name]").map(function(e){var t=ld$.parent(e,"[ldform]",r.root);if(!t||r.root===t)return t=e.getAttribute("name"),n[t]?Array.isArray(n[t])?n[t].push(e):n[t]=[n[t],e]:n[t]=e}),n},checkAll:function(){var r;return Promise.all(function(){var e,t=[];for(r in e=this.fields)e[r],t.push(this.check({n:r,now:!0}));return t}.call(this))},check:function(l){var a=this;return null==l&&(l={}),Array.isArray(l)?Promise.all(l.map(function(e){return a.check(e)})):new Promise(function(e,t){var r,n,i={n:l.n,e:l.e,now:l.now},u=i.n,s=(i.e,i.now);if(!u||c(u,a.names(r)))return null==u||a.fields[u]?(r=(i=[a.fields,a.status])[1],(i=i[0])[u]&&(Array.isArray(i[u])?(n=i[u].filter(function(e){return e.checked}).map(function(e){return e.value}),"radio"===i[u][0].getAttribute("type")&&(n=n[0])):n=i[u].value,r[u]=a.verify(u,n,i[u])),a.debounce(u,r)&&!s?a.checkDebounced(u,i,r,e,t):a.checkDebounced(u,i,r,e,t).now()):t(new Error("ldform.check: field "+u+" not found."))})}}),"undefined"!=typeof module&&null!==module?module.exports=e:"undefined"!=typeof window&&null!==window&&(window.ldform=e)}.call(this);
