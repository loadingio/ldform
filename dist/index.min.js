!function(){var e;function c(e,t){for(var n=-1,r=t.length>>>0;++n<r;)if(e===t[n])return!0;return!1}(e=function(t){var e,n,r,i,u,s,a,l,o=this;for(a in null==t&&(t={}),this.opt=t,this.root=e="string"==typeof t.root?ld$.find(document,t.root,0):t.root,this.evtHandler={},this.fields={},this.status=r={all:1},this.el=i={},null!=t.submit&&(i.submit="string"==typeof t.submit?ld$.find(this.root,t.submit,0):t.submit),i.submit||(u=ld$.find(e,"[type=submit]",0))&&(i.submit=u),["debounce","verify","names","getFields","afterCheck"].map(function(e){if(t[e])return o[e]=t[e]}),s=function(e){return o.check({n:e&&e.target?e.target.getAttribute("name"):void 0,e:e})},this.fields=n=this.getFields(e),this.values(t.values||{}),n)l=n[a],(Array.isArray(l)?l:[l]).map(c),r[a]=1;return this.checkDebounced=debounce(330,function(e,n,r,t,i){var u,s=this.names(r),a=r.all;return delete r.all,this.afterCheck(r,n),u=s.map(function(e){return null!=r[e]&&0===r[e]}).filter(function(e){return!e}).length,null==r.all&&(r.all=u?1:0),s.map(function(t){return(Array.isArray(n[t])?n[t]:[n[t]]).map(function(e){e=e.classList;return e.toggle("is-invalid",2===r[t]),e.toggle("is-valid",r[t]<1),e})}),a!==r.all&&this.fire("readystatechange",0===r.all),(a=this.el.submit)&&a.classList.toggle("disabled",0!==r.all),t()}),t.init&&t.init.apply(this),this.opt.initCheck&&this.checkAll(),this;function c(t){return["change","input","paste"].forEach(function(e){return t.addEventListener(e,s)})}}).prototype=function(e,t){var n,r={}.hasOwnProperty;for(n in t)r.call(t,n)&&(e[n]=t[n]);return e}(Object.create(Object.prototype),{on:function(e,t){var n;return((n=this.evtHandler)[e]||(n[e]=[])).push(t)},fire:function(e){for(var t,n,r,i,u=[],s=[],a=1,l=arguments.length;a<l;++a)s.push(arguments[a]);for(t=s,a=0,r=(n=this.evtHandler[e]||[]).length;a<r;++a)i=n[a],u.push(i.apply(this,t));return u},field:function(e){return this.fields[e]},reset:function(){var e=[this.status,this.fields],n=e[0],r=e[1];return n.all=1,this.names(n).map(function(e){var t=r[e];return Array.isArray(t)?t.map(function(e){return e.checked=it.defaultChecked,e.classList.remove("is-invalid","is-valid")}):(t.value="",t.classList.remove("is-invalid","is-valid")),n[e]=1}),this.check()},ready:function(){return 0===this.status.all},verify:function(e,t,n){return t?0:2},names:function(){var e,t=[];for(e in this.fields)t.push(e);return t},debounce:function(){return!0},afterCheck:function(){},values:function(e){var n,t,r,i,u,s=[],a=this;if(null!=e){for(n in t=e||{})r=t[n],(i=this.fields[n])&&(i=Array.isArray(i)?i:[i],s.push(i.map(l)));return s}for(n in u={},t=this.fields)r=t[n],(Array.isArray(r)?r:[r]).map(o);return u;function l(e){var t=e.getAttribute("type");if("file"!==t)return"radio"===t?e.checked=e.value===r:"checkbox"===t?e.checked=c(e.value,r||[]):a.fields[n].value=r}function o(e){var t=e.getAttribute("type");return"checkbox"!==t?"radio"!==t?u[n]="checkbox"===e.getAttribute("type")?e.checked:e.value:e.checked?u[n]=e.value:void 0:e.checked?(u[n]||(u[n]=[])).push(e.value):void 0}},getfd:function(){var t,e,n,r,i,u,s=new FormData;for(t in e=this.fields)if((n=e[t]).files&&n.files.length)for(r=0,i=n.files.length;r<i;++r)u=r,s.append(t+"[]",n.files[u]);else Array.isArray(n)?n.map(a):s.append(t,n.value);return s;function a(e){if(e.checked)return s.append(t+"[]",e.value)}},getFields:function(e){var n=this,r={};return ld$.find(this.root,"[name]").map(function(e){var t=ld$.parent(e,"[ldform]",n.root);if(!t||n.root===t)return t=e.getAttribute("name"),r[t]?Array.isArray(r[t])?r[t].push(e):r[t]=[r[t],e]:r[t]=e}),r},checkAll:function(){var n;return Promise.all(function(){var e,t=[];for(n in e=this.fields)e[n],t.push(this.check({n:n,now:!0}));return t}.call(this))},check:function(l){var o=this;return null==l&&(l={}),Array.isArray(l)?Promise.all(l.map(function(e){return o.check(e)})):new Promise(function(e,t){var n,r,i,u={n:l.n,e:l.e,now:l.now},s=u.n,a=u.now;if(!s||c(s,o.names(r)))return null==s||o.fields[s]?(u=[o.fields,o.status],n=u[0],r=u[1],n[s]&&(Array.isArray(n[s])?(i=n[s].filter(function(e){return e.checked}).map(function(e){return e.value}),"radio"===n[s][0].getAttribute("type")&&(i=i[0])):i=n[s].value,i=o.verify(s,i,n[s])),(i&&i.then?i.then(function(e){return r[s]=e}):Promise.resolve(r[s]=i)).then(function(){return o.debounce(s,r)&&!a?o.checkDebounced(s,n,r,e,t):o.checkDebounced(s,n,r,e,t).now()})):t(new Error("ldform.check: field "+s+" not found."))})}}),"undefined"!=typeof module&&null!==module?module.exports=e:"undefined"!=typeof window&&null!==window&&(window.ldform=e)}.call(this);
